<%= form_for @checkout, html: {multipart: true, id: "checkout-form"}, validate: true do |form| %>
  <div class="h-screen grid grid-cols-3">
    <div x-data="{open: true}" class="lg:col-span-2 col-span-3 bg-indigo-50 space-y-8 px-12">
      <div x-show="open" class="mt-8 p-4 relative flex flex-col sm:flex-row sm:items-center bg-white shadow rounded-md">
        <div class="flex flex-row items-center border-b sm:border-b-0 w-full sm:w-auto pb-4 sm:pb-0">
          <div class="text-yellow-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 sm:w-5 h-6 sm:h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div class="text-sm font-medium ml-3">Checkout</div>
        </div>
        <div class="text-sm tracking-wide text-gray-500 mt-4 sm:mt-0 sm:ml-4">Complete your shipping and payment details below.</div>
        <div class="absolute sm:relative sm:top-auto sm:right-auto ml-auto right-4 top-4 text-gray-400 hover:text-gray-800 cursor-pointer">
          <button @click="open = !open">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
          </button>
        </div>
      </div>
      <div class="rounded-md">
        <form id="payment-form" method="POST" action="">
          <section>
            <h2 class="uppercase tracking-wide text-lg font-semibold text-gray-700 my-2">Shipping & Billing Information</h2>
            <fieldset class="mb-3 bg-white shadow-lg rounded text-gray-600">
              <label class="flex border-b border-gray-200 h-12 py-4 items-center">
                <span class="text-left pl-4 pr-2 w-40">Name</span>
                <%= form.text_field :name, class: "focus:outline-none px-3 w-2/3", value: current_user ? current_user.name : "" %>
              </label>
              <label class="flex border-b border-gray-200 h-12 py-4 items-center">
                <span class="text-left pl-4 pr-2 w-40">Email</span>
                <%= form.email_field :email, class: "focus:outline-none px-3 w-2/3", value: current_user ? current_user.email : "" %>
              </label>
              <label class="flex border-b border-gray-200 h-12 py-4 items-center">
                <span class="text-left pl-4 pr-2 w-40">Address</span>
                <%= form.text_field :address, class: "focus:outline-none px-3 w-2/3" %>
              </label>
              <label class="flex border-b border-gray-200 h-12 py-4 items-center">
                <span class="text-left pl-4 pr-2 w-40">Phone number</span>
                <%= form.text_field :phone_number, class: "focus:outline-none px-3 w-2/3" %>
              </label>
            </fieldset>
          </section>
        </form>
      </div>
      <%= hidden_field_tag(:order_id, @order.id) %>
      <%= form.submit "Pay", class: "submit-button cursor-pointer px-4 py-3 rounded-full bg-indigo-400 hover:bg-indigo-500 text-white focus:ring focus:outline-none w-full text-xl font-semibold transition-colors" %>
    </div>
    <div class="col-span-1 bg-white lg:block hidden">
      <h1 class="py-6 border-b-2 text-xl text-gray-600 px-8">Order Summary</h1>
      <ul class="py-6 border-b space-y-6 px-8">
        <% @line_items.each do |line_item| %>
          <li class="grid grid-cols-6 gap-2 border-b-1">
            <div class="col-span-1 self-center">
              <% if line_item.product.image.attached? %>
                <%= image_tag line_item.product.image, class: "rounded w-full" %>
              <% else %>
                <img alt="product-image" class="rounded w-full" src="https://images.unsplash.com/photo-1593642632823-8f785ba67e45?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1189&q=80">
              <% end %>
            </div>
            <div class="flex flex-col col-span-3 pt-2">
              <span class="text-gray-600 text-md font-semi-bold"><%= line_item.product.name %></span>
              <span class="text-gray-400 text-sm inline-block pt-2"><%= line_item.product.name %></span>
            </div>
            <div class="col-span-2 pt-3">
              <div class="flex items-center space-x-1 text-sm justify-between">
                <span class="text-gray-400"><%= line_item.quantity %> x <%= line_item.unit_price %></span>
                <span class="text-indigo-400 font-semibold inline-block"><%= line_item.total_price %></span>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
      <div class="px-8 border-b">
        <div class="flex justify-between py-4 text-gray-600">
          <span>Shipping</span>
          <span class="font-semibold text-indigo-500">Free</span>
        </div>
      </div>
      <div class="px-8 border-b pt-8">
        <div class="font-semibold text-xl flex justify-between py-4 text-gray-600 ">
          <span>Subtotal</span>
          <span id="subtotal" class="font-semibold text-indigo-500"><%= @order.subtotal %></span>
        </div>
        <div class="font-semibold text-xl flex justify-between py-4 text-gray-600">
          <span>Discount</span>
          <span id="discount-text" class="font-semibold text-indigo-500">0</span>
        </div>
        <div class="font-semibold text-xl flex justify-between py-4 text-gray-600">
          <span>Total</span>
          <span id="total" class="font-semibold text-indigo-500"><%= @order.subtotal %></span>
        </div>
      </div>
    </div>
  </div>
<% end %>
<%#= javascript_pack_tag 'checkout', 'data-turbolinks-track': 'reload' %>